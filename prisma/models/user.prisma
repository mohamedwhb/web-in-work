model User {
  id                String    @id @default(uuid())
  name              String
  username          String    @unique
  email             String    @unique
  password          String
  passwordChangedAt DateTime? @map("password_changed_at")
  passwordExpiredAt DateTime? @map("password_expired_at")
  avatar            String?
  active            Boolean   @default(true) @map("is_active")
  lastLogin         DateTime? @map("last_login")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  roleId            String    @map("role_id")
  employee          Employee?
  role              Role      @relation(fields: [roleId], references: [id])
  logs              UserLog[]

  @@index([email], map: "idx_user_email")
  @@index([roleId], map: "idx_user_role")
}

model Role {
  id              String       @id @default(uuid()) @map("id")
  key             String       @unique @map("role_key")
  users           User[]
  rolePermissions Permission[] @relation("PermissionToRole")
}

model Permission {
  id              String    @id @default(uuid()) @map("id")
  key             String    @unique @map("perm_key")
  employeeId      String?
  Employee        Employee? @relation(fields: [employeeId], references: [id])
  rolePermissions Role[]    @relation("PermissionToRole")
}

model Employee {
  id           String          @id @default(uuid())
  userId       String          @unique @map("user_id")
  zip          String
  city         String
  country      String          @default("at")
  street       String
  phone        String
  departmentId String?         @map("department_id")
  positionId   String?         @map("position_id")
  status       EmployeeStatus? @default(active)
  joinDate     DateTime?       @default(now()) @map("join_date")
  notes        String?
  vacationDays Int?            @default(0) @map("vacation_days")
  team         String?
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")
  documents    Document[]
  department   Department?     @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  position     Position?       @relation(fields: [positionId], references: [id], onDelete: Cascade)
  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  permissions  Permission[]
  skills       Skill[]         @relation("EmployeeToSkill")

  @@index([status], map: "idx_emp_status")
  @@index([departmentId], map: "idx_emp_dep")
}

model Document {
  id         String   @id @default(uuid())
  name       String
  path       String
  employeeId String
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  employee   Employee @relation(fields: [employeeId], references: [id])

  @@index([name], map: "idx_doc_name")
}

model Skill {
  id        String     @id @default(uuid())
  name      String
  level     Int
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  employees Employee[] @relation("EmployeeToSkill")

  @@index([name], map: "idx_skill_name")
}

model Department {
  id        String     @id @default(uuid())
  name      String
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  employees Employee[]

  @@index([name], map: "idx_dep_name")
}

model Position {
  id        String     @id @default(uuid())
  name      String
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  employees Employee[]

  @@index([name], map: "idx_pos_name")
}

model UserLog {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  action    String
  ipAddress String?  @map("ip_address")
  timestamp DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "idx_log_user")
  @@index([timestamp], map: "idx_log_time")
  @@map("user_logs")
}

model PasswordPolicy {
  id               Int      @id @default(1)
  minLength        Int      @default(8) @map("min_length")
  requireUppercase Boolean  @default(true) @map("require_uppercase")
  requireNumber    Boolean  @default(true) @map("require_digits")
  requireSymbol    Boolean  @default(true) @map("require_special_chars")
  expiryInDays     Int      @default(90) @map("expiry_in_days")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")
}

enum EmployeeStatus {
  active
  inactive
  on_leave
}

enum Status {
  active
  inactive
  on_leave
}
